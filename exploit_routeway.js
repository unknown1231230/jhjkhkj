const { createClient } = require('@supabase/supabase-js');

const supabaseUrl = 'https://auth.routeway.ai';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTc2NTk4MjgyMSwiZXhwIjoyMDgxNTU4ODIxfQ.tLjYIU1b5ozMCc2Bx0pLcUe7EIDr4uM1CAUio5pjXEk';

const cf_clearance = "3LZngwuxGyTOwPvuRUrthuHp7XZ9LoaE9keWotOYTA8-1771276734-1.2.1.1-y1IYIDLUY89O401GH2oC8MaCnvVR5omQRH1v0Lp6TMHYiPzXm4jZvEtAfSTx2HuQI5d_2ah2kNvcCslde1_6ysIYvsFgdl5iha9WnH9Jj__tpmHpXAQ2AeZUBCxyxHHSXTbVJwaxpKxnkAhCA8e7U7LDJu8F8xX5ct1i9WX6XsXgQz6kcnBjFtOoQtAEdJyBPnCvz8coFg_PH7kda30nmSSV2TMoG0xHvVM9NyVkdjs";

const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  global: {
    headers: {
      'Cookie': `cf_clearance=${cf_clearance}`,
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36',
    }
  }
});

async function checkUser() {
  const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI4ODI3NDNjYi0yZTY2LTQ1MDktOGEyNy0yZjFhNjlmZjUxYzciLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzcxMjgxMzk1LCJpYXQiOjE3NzEyNzc3OTUsImVtYWlsIjoiZXllcm91c2hhbG1pMUBnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6Imdvb2dsZSIsInByb3ZpZGVycyI6WyJnb29nbGUiXX0sInVzZXJfbWV0YWRhdGEiOnsiYXZhdGFyX3VybCI6Imh0dHBzOi8vbGgzLmdvb2dsZXVzZXJjb250ZW50LmNvbS9hL0FDZzhvY0pRWnVxLVVSRU5CSnEzNFIzLVBTN2RSa2doSk5nMW9iVlN0NklyQTFiN3lRWTJYalk9czk2LWMiLCJlbWFpbCI6ImV5ZXJvdXNoYWxtaTFAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImZ1bGxfbmFtZSI6IkV0aGFuIFllcm91c2hhbG1pIiwiaXNzIjoiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tIiwibmFtZSI6IkV0aGFuIFllcm91c2hhbG1pIiwicGhvbmVfdmVyaWZpZWQiOmZhbHNlLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2EvQUNnOG9jSlFadXEtVVJFTkJKcTM0UjMtUFM3ZFJrZ2hKTmcxb2JWU3Q2SXJBMWI3eVFZMlhqWT1zOTYtYyIsInByb3ZpZGVyX2lkIjoiMTE4MTgwMjk4MTA4NTUyMjIxMjU2Iiwic3ViIjoiMTE4MTgwMjk4MTA4NTUyMjIxMjU2In0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMSIsImFtciI6W3sibWV0aG9kIjoib2F1dGgiLCJ0aW1lc3RhbXAiOjE3NzEyNzY3NTV9XSwic2Vzc2lvbl9pZCI6IjIyMjFlMDgyLTdiMDctNDJiZC04ODY0LWYyY2U1MmY0ZTUyMSIsImlzX2Fub255bW91cyI6ZmFsc2V9.hg65TbnuEgPi3l2-HaidexeQ5khh_RFaKF8hKazkCVE";
  
  const { data: { user }, error } = await supabase.auth.getUser(token);
  if (error) {
    console.error('Error fetching user:', error);
  } else {
    console.log('User identified:', user.email);
    
    // Try to query public tables
    console.log('Querying profiles...');
    const { data: profiles, error: pError } = await supabase.from('profiles').select('*');
    if (pError) console.error('Profiles error:', pError);
    else console.log('Profiles:', profiles);
    
    // Try to update metadata
    console.log('Attempting metadata upgrade...');
    const { data: updateData, error: updateError } = await supabase.auth.updateUser({
      data: { credits: 999999, plan: "unlimited", tier: "unlimited" }
    });
    if (updateError) {
      console.error('Update failed:', updateError);
    } else {
      console.log('Update success!', updateData);
    }
  }
}

checkUser();
