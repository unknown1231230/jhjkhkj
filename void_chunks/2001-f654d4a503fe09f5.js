"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2001],{37621:(e,r,t)=>{async function a(){try{let e=await fetch("/api/keys",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch keys");return(await e.json()).keys}catch(e){throw console.error("Error fetching user keys:",e),e}}async function o(e,r){try{let t=await fetch("/api/keys/".concat(e,"/update-label"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:r}),credentials:"include"});if(!t.ok)throw Error("Failed to update API key label");return await t.json()}catch(e){throw console.error("Error updating API key label:",e),e}}async function n(e){try{let r=await fetch("/api/keys/generate",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({hcaptchaToken:e})});if(!r.ok)throw Error("Failed to generate API key");return await r.json()}catch(e){throw console.error("Error generating API key:",e),e}}async function i(e){try{let r=await fetch("/api/keys/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok)throw Error("Failed to delete API key");return await r.json()}catch(e){throw console.error("Error deleting API key:",e),e}}async function s(e){try{let r=await fetch("/api/keys/".concat(e,"/disable"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok)throw Error("Failed to disable API key");return await r.json()}catch(e){throw console.error("Error disabling API key:",e),e}}async function c(e){try{let r=await fetch("/api/keys/".concat(e,"/enable"),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include"});if(!r.ok)throw Error("Failed to enable API key");return await r.json()}catch(e){throw console.error("Error enabling API key:",e),e}}async function l(e,r){try{let t=await fetch("/api/redeem",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({code:e,hcaptchaToken:r})}),a=await t.json();if(!t.ok)throw Error(a.message||"Failed to redeem code");return a}catch(e){throw console.error("Error redeeming code:",e),e}}async function d(){try{let e=await fetch("/api/models",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch models data");return await e.json()}catch(e){throw console.error("Error fetching API models:",e),e}}async function u(){try{let e=await fetch("/api/discounts",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw Error("Failed to fetch discount data");return await e.json()}catch(e){throw console.error("Error fetching user discounts:",e),e}}t.d(r,{Fo:()=>c,Lh:()=>i,MT:()=>u,Pq:()=>d,So:()=>a,U$:()=>s,XH:()=>n,xx:()=>o,yM:()=>l})},92001:(e,r,t)=>{t.d(r,{A:()=>l,O:()=>c});var a=t(95155),o=t(12115),n=t(20063),i=t(37621);let s=(0,o.createContext)(void 0),c=e=>{let{children:r}=e,[t,c]=(0,o.useState)(null),[l,d]=(0,o.useState)(!0),[u,h]=(0,o.useState)(0),p=(0,n.useRouter)();(0,o.useEffect)(()=>{f()},[]);let y=async()=>{if(!t||!t.plan_expires_at)return!1;if(new Date(1e3*parseInt(t.plan_expires_at))<new Date&&"free"!==t.plan)try{if((await fetch("/api/auth/update-expired-plan",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})).ok){let e=await (0,i.So)();if(e&&e.length>0)for(let r of e)await (0,i.Lh)(r._id);return await f(),!0}}catch(e){console.error("Error handling plan expiration:",e)}return!1},f=async()=>{try{h(Date.now()),t||d(!0);let e=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(e.ok){let r=await e.json(),t={...r,plan_expires_at:r.plan_expires_at?String(r.plan_expires_at):null};c(t),t&&t.plan_expires_at&&await y()}else 403===e.status&&"/login"!==window.location.pathname&&"/register"!==window.location.pathname&&(await e.json()).requiresVerification&&!window.location.pathname.includes("/success")&&p.push("/login"),c(null)}catch(e){console.error("Error fetching user info:",e),c(null)}finally{d(!1)}},w=async(e,r,t,a)=>{try{let o=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:r,password:t,hcaptchaToken:a})}),n=await o.json();if(!o.ok)return{success:!1,error:n.message||"Registration failed"};return{success:!0,requiresVerification:n.requiresVerification||!1,email:n.email}}catch(e){return console.error("Registration error:",e),{success:!1,error:"An unexpected error occurred"}}},g=async(e,r)=>{try{let t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r}),credentials:"include"}),a=await t.json();if(!t.ok){if(403===t.status&&a.requiresVerification)return{success:!1,error:a.message||"Email verification required",requiresVerification:!0,email:a.email,codeExpired:a.codeExpired||!1};return{success:!1,error:a.message||"Login failed"}}if(a.requires2FA)return{success:!1,requires2FA:!0,email:a.email};return await f(),{success:!0}}catch(e){return console.error("Login error:",e),{success:!1,error:"An unexpected error occurred"}}},m=async(e,r,t)=>{try{let a=await fetch("/api/auth/2fa/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r,totpCode:t}),credentials:"include"}),o=await a.json();if(!a.ok)return{success:!1,error:o.message||"Invalid code"};return await f(),{success:!0}}catch(e){return console.error("2FA verification error:",e),{success:!1,error:"An unexpected error occurred"}}},k=async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),c(null),p.push("/login")}catch(e){console.error("Logout error:",e)}},T=async(e,r)=>{try{let t=await fetch("/api/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,code:r}),credentials:"include"}),a=await t.json();if(!t.ok)return{success:!1,message:a.message||"Verification failed",expired:a.expired};return a.success&&await f(),{success:a.success,message:a.message,alreadyVerified:a.alreadyVerified}}catch(e){return console.error("Error verifying email:",e),{success:!1,message:"An error occurred during verification"}}},j=async e=>{try{let r=await fetch("/api/auth/verify-email",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(!r.ok)return{success:!1,message:t.message||"Failed to send verification code"};return{success:!0,message:t.message||"Verification code has been sent"}}catch(e){return console.error("Error sending verification code:",e),{success:!1,message:"An error occurred while sending verification code"}}},E=async e=>{try{let r=await fetch("/api/auth/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),t=await r.json();if(!r.ok)return{success:!1,message:t.message||"Failed to send reset link"};return{success:!0}}catch(e){return console.error("Password reset request error:",e),{success:!1,message:"An unexpected error occurred"}}},P=async(e,r,t)=>{try{let a=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,email:r,password:t})}),o=await a.json();if(!a.ok)return{success:!1,message:o.message||"Failed to reset password",invalidToken:o.invalidToken};return{success:!0}}catch(e){return console.error("Password reset error:",e),{success:!1,message:"An unexpected error occurred"}}};return(0,a.jsx)(s.Provider,{value:{currentUser:t,isLoading:l,login:g,register:w,logout:k,getUserInfo:f,verifyEmail:T,resendVerificationCode:j,requestPasswordReset:E,resetPassword:P,checkPlanExpiration:y,verify2FA:m},children:r})},l=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);